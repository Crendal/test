Sub Merge()
    Dim fd As FileDialog, f, A(), i As Long, j As Long
    Dim wb As Workbook, r As Long
    Dim temp As String, t2 As Long
    Dim ur As Range
    Dim fullPath As String, fName As String, dotPos As Long
    Dim key8 As String
    
    Set fd = Application.FileDialog(msoFileDialogFilePicker)
    fd.AllowMultiSelect = True
    If fd.Show <> -1 Then Exit Sub

    ReDim A(1 To fd.SelectedItems.Count, 1 To 2)
    For i = 1 To UBound(A)
        fullPath = fd.SelectedItems(i)
        fName = Dir(fullPath)                 ' 전체 경로에서 파일명만 추출
        
        dotPos = InStrRev(fName, ".")         ' 마지막 점 위치(확장자 앞)
        If dotPos > 0 Then
            ' 확장자 제외한 파일 이름 부분에서 끝 8자리 추출
            key8 = Right(Left(fName, dotPos - 1), 8)
        Else
            ' 혹시 확장자 없으면 그냥 파일명 끝 8자리
            key8 = Right(fName, 8)
        End If
        
        A(i, 1) = fullPath
        A(i, 2) = CLng(key8)                  ' 여기서 이제 순수 8자리 숫자라서 에러 안 남
    Next

    '=== 정렬 부분 그대로 ===
    For i = 1 To UBound(A) - 1
        For j = i + 1 To UBound(A)
            If A(i, 2) > A(j, 2) Then
                temp = A(i, 1): A(i, 1) = A(j, 1): A(j, 1) = temp
                t2 = A(i, 2): A(i, 2) = A(j, 2): A(j, 2) = t2
            End If
        Next j
    Next i

    ' 병합 시트 2행부터
    r = 2

    For i = 1 To UBound(A)
        Set wb = Workbooks.Open(A(i, 1))

        With wb.Sheets(1)
            Set ur = .UsedRange
            If ur.Rows.Count > 1 Then
                ' 각 파일의 2번째 행부터 복사
                ur.Offset(1).Resize(ur.Rows.Count - 1).Copy _
                    ThisWorkbook.Sheets(1).Cells(r, 1)
                r = ThisWorkbook.Sheets(1).Cells(Rows.Count, 1).End(xlUp).Row + 1
            End If
        End With

        wb.Close False
    Next i
End Sub
